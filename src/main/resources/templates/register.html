<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Ãnregistrare SecurizatÄƒ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Stiluri pentru feedback vizual */
        .is-valid { border-color: #198754 !important; background-image: none !important; }
        .is-invalid { border-color: #dc3545 !important; background-image: none !important; }
        .feedback-text { font-size: 0.8em; margin-top: 2px; }
        .text-danger { color: #dc3545; }
        .text-success { color: #198754; }
        ul { list-style: none; padding-left: 0; font-size: 0.85em; }
    </style>
</head>
<body class="bg-light d-flex align-items-center justify-content-center py-5" style="min-height: 100vh;">

<div class="card shadow" style="width: 550px;">
    <div class="card-header bg-primary text-white text-center">
        <h3>ğŸ“ CreeazÄƒ Cont Nou</h3>
    </div>
    <div class="card-body p-4">

        <div th:if="${eroare}" class="alert alert-danger" th:text="${eroare}"></div>

        <form action="/register" method="post" th:object="${user}" id="regForm" novalidate>

            <div class="row mb-3">
                <div class="col-md-6">
                    <label>Nume</label>
                    <input type="text" th:field="*{nume}" id="nume" class="form-control" placeholder="Popescu">
                    <div id="numeFeedback" class="feedback-text text-danger"></div>
                    <div class="text-danger small" th:if="${#fields.hasErrors('nume')}" th:errors="*{nume}"></div>
                </div>
                <div class="col-md-6">
                    <label>Prenume</label>
                    <input type="text" th:field="*{prenume}" id="prenume" class="form-control" placeholder="Ion">
                    <div id="prenumeFeedback" class="feedback-text text-danger"></div>
                    <div class="text-danger small" th:if="${#fields.hasErrors('prenume')}" th:errors="*{prenume}"></div>
                </div>
            </div>

            <div class="mb-3">
                <label>Email</label>
                <input type="email" th:field="*{email}" id="email" class="form-control" placeholder="exemplu@email.com">
                <div id="emailFeedback" class="feedback-text text-danger"></div>
                <div class="text-danger small" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></div>
            </div>

            <div class="mb-3">
                <label class="form-label fw-bold">Telefon (OpÈ›ional)</label>

                <input type="text" th:field="*{telefon}" id="telefon" class="form-control"
                       placeholder="07xx..."
                       th:classappend="${#fields.hasErrors('telefon')} ? 'is-invalid' : ''">

                <div id="telefonFeedback" class="feedback-text text-danger"></div>

                <div class="invalid-feedback" th:if="${#fields.hasErrors('telefon')}" th:errors="*{telefon}">
                    Eroare telefon
                </div>

                <div class="form-text text-muted small">
                    DacÄƒ completezi, foloseÈ™te un numÄƒr valid de 10 cifre.
                </div>
            </div>

            <div class="mb-3">
                <label>ParolÄƒ</label>
                <input type="password" th:field="*{parola}" id="parola" class="form-control">

                <div class="mt-2 p-2 bg-light border rounded">
                    <strong>CerinÈ›e parolÄƒ:</strong>
                    <ul>
                        <li id="req-len" class="text-danger">âŒ Minim 6 caractere</li>
                        <li id="req-upper" class="text-danger">âŒ O literÄƒ MARE</li>
                        <li id="req-digit" class="text-danger">âŒ O cifrÄƒ (0-9)</li>
                    </ul>
                </div>
            </div>

            <div class="mb-3">
                <label>Tip Cont</label>
                <select th:field="*{rol}" class="form-select">
                    <option value="CLIENT">Client (CumpÄƒrÄƒtor)</option>
                    <option value="AGENT">Agent (VÃ¢nzÄƒtor)</option>
                </select>
            </div>

            <button type="submit" id="submitBtn" class="btn btn-secondary w-100 py-2" disabled>
                CompleteazÄƒ toate cÃ¢mpurile
            </button>
        </form>

        <div class="text-center mt-3">
            <a href="/login" class="text-decoration-none">Ai deja cont? IntrÄƒ Ã®n cont</a>
        </div>
    </div>
</div>

<script>
    // Selectare elemente
    const inputs = {
        nume: document.getElementById('nume'),
        prenume: document.getElementById('prenume'),
        email: document.getElementById('email'),
        telefon: document.getElementById('telefon'),
        parola: document.getElementById('parola')
    };
    const submitBtn = document.getElementById('submitBtn');

    // Regex-uri
    const regexNume = /^[a-zA-ZÄƒÃ¢Ã®È™È›Ä‚Ã‚ÃÈ˜Èš -]{3,20}$/; // Doar litere, spatiu, cratima
    const regexEmail = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; // Format email simplu
    const regexTelefon = /^07[0-9]{8}$/; // Format RO: 07xxxxxxxx

    // Functie globala de verificare
    function valideazaTot() {
        let validNume = valideazaCamp(inputs.nume, regexNume, "3-20 litere, fÄƒrÄƒ cifre.");
        let validPrenume = valideazaCamp(inputs.prenume, regexNume, "3-20 litere, fÄƒrÄƒ cifre.");
        let validEmail = valideazaCamp(inputs.email, regexEmail, "Email invalid (trebuie @ È™i .)");
        let validParola = valideazaParola();

        // VALIDARE TELEFON (Optionala)
        let validTelefon = true;
        let valTel = inputs.telefon.value.trim();
        const feedbackDiv = document.getElementById('telefonFeedback');

        if (valTel !== "") {
            // Daca a scris ceva, trebuie sa fie valid
            if (!regexTelefon.test(valTel)) {
                inputs.telefon.classList.add('is-invalid');
                inputs.telefon.classList.remove('is-valid');
                feedbackDiv.innerText = "Format invalid (Ex: 0722123456)";
                validTelefon = false;
            } else {
                inputs.telefon.classList.remove('is-invalid');
                inputs.telefon.classList.add('is-valid');
                feedbackDiv.innerText = "";
                validTelefon = true;
            }
        } else {
            // Daca e gol, e valid (dar scoatem culorile)
            inputs.telefon.classList.remove('is-valid', 'is-invalid');
            feedbackDiv.innerText = "";
            validTelefon = true;
        }

        // Activare Buton
        if (validNume && validPrenume && validEmail && validParola && validTelefon) {
            submitBtn.disabled = false;
            submitBtn.classList.remove('btn-secondary');
            submitBtn.classList.add('btn-success');
            submitBtn.innerText = "ğŸš€ ÃnregistreazÄƒ-te";
        } else {
            submitBtn.disabled = true;
            submitBtn.classList.add('btn-secondary');
            submitBtn.classList.remove('btn-success');
            submitBtn.innerText = "CompleteazÄƒ corect datele";
        }
    }

    // Functie ajutatoare standard
    function valideazaCamp(input, regex, msgEroare) {
        const val = input.value.trim();
        const feedbackDiv = document.getElementById(input.id + 'Feedback');

        if (!regex.test(val)) {
            input.classList.add('is-invalid');
            input.classList.remove('is-valid');
            if(feedbackDiv) feedbackDiv.innerText = msgEroare;
            return false;
        } else {
            input.classList.remove('is-invalid');
            input.classList.add('is-valid');
            if(feedbackDiv) feedbackDiv.innerText = "";
            return true;
        }
    }

    // Validare Parola (Criterii multiple)
    function valideazaParola() {
        const val = inputs.parola.value;
        let score = 0;

        // Lungime
        const rLen = document.getElementById('req-len');
        if (val.length >= 6 && val.length <= 20) {
            rLen.className = 'text-success'; rLen.innerHTML = 'âœ… Minim 6 caractere'; score++;
        } else {
            rLen.className = 'text-danger'; rLen.innerHTML = 'âŒ Minim 6 caractere';
        }

        // Litera Mare
        const rUpper = document.getElementById('req-upper');
        if (/[A-Z]/.test(val)) {
            rUpper.className = 'text-success'; rUpper.innerHTML = 'âœ… O literÄƒ MARE'; score++;
        } else {
            rUpper.className = 'text-danger'; rUpper.innerHTML = 'âŒ O literÄƒ MARE';
        }

        // Cifra
        const rDigit = document.getElementById('req-digit');
        if (/[0-9]/.test(val)) {
            rDigit.className = 'text-success'; rDigit.innerHTML = 'âœ… O cifrÄƒ (0-9)'; score++;
        } else {
            rDigit.className = 'text-danger'; rDigit.innerHTML = 'âŒ O cifrÄƒ (0-9)';
        }

        return score === 3;
    }

    // Adaugam ascultatori
    Object.values(inputs).forEach(input => {
        if(input) { // Verificam sa existe inputul
            input.addEventListener('input', valideazaTot);
            input.addEventListener('blur', valideazaTot);
        }
    });

</script>
</body>
</html>